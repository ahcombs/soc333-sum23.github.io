{
  "hash": "8f5ae2e0e59b9965a03c128d8121d1a6",
  "result": {
    "markdown": "---\ntitle: \"Modelling loan interest rates\"\ncategories: \n  - Application exercise\neditor: visual\n---\n\n\nIn this application exercise we will be studying loan interest rates.\nThe dataset is one you've come across before in your reading -- the dataset about loans from the peer-to-peer lender, Lending Club, from the **openintro** package.\nWe will use **tidyverse** and **tidymodels** for data exploration and modeling, respectively.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(openintro)\n```\n:::\n\n\nBefore we use the dataset, we'll make a few transformations to it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloans <- loans_full_schema %>%\n  mutate(\n    credit_util = total_credit_utilized / total_credit_limit,\n    bankruptcy  = as.factor(if_else(public_record_bankrupt == 0, 0, 1)),\n    verified_income = droplevels(verified_income),\n    homeownership = str_to_title(homeownership),\n    homeownership = fct_relevel(homeownership, \"Rent\", \"Mortgage\", \"Own\")\n    ) %>%\n  rename(credit_checks = inquiries_last_12m) %>%\n  select(interest_rate, verified_income, debt_to_income, credit_util, bankruptcy, term, credit_checks, issue_month, homeownership) \n```\n:::\n\n\nHere is a glimpse at the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 7\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…\n$ island            <fct> Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <fct> male, female, female, NA, female, male, female, male…\n```\n:::\n:::\n\n\n# Interest rate vs. credit utilization ratio\n\nThe regression model for interest rate vs. credit utilization is as follows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrate_util_fit <- linear_reg() |>\n  fit(interest_rate ~ credit_util, data = loans)\n\ntidy(rate_util_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  term        estimate std.error statistic   p.value\n  <chr>          <dbl>     <dbl>     <dbl>     <dbl>\n1 (Intercept)    10.5     0.0871     121.  0        \n2 credit_util     4.73    0.180       26.3 1.18e-147\n```\n:::\n:::\n\n\nAnd here is the model visualized:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(loans, aes(x = credit_util, y = interest_rate)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula 'y ~ x'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite values (stat_smooth).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values (geom_point).\n```\n:::\n\n::: {.cell-output-display}\n![](ae-15-modelling-loan-interest-rates_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n-   **Your turn:** What is the estimated interest rate for a loan applicant with credit utilization of 0.8, i.e. someone whose total credit balance is 80% of their total available credit?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n# Interest rate vs. homeownership\n\nNext we predict interest rates from homeownership, which is a categorical predictor with three levels:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(loans$homeownership)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Rent\"     \"Mortgage\" \"Own\"     \n```\n:::\n:::\n\n\n-   **Demo:** Fit the linear regression model to predict interest rate from homeownership and display a tidy summary of the model. Write the estimated model output below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n-   **Your turn:** Interpret each coefficient in context of the problem.\n\n    -   Intercept: *Add response here.*\n\n    -   Slopes: *Add response here.*\n\n# Interest rate vs. credit utilization and homeownership\n\n## Main effects model\n\n-   **Demo:** Fit a model to predict interest rate from credit utilization and homeownership, **without** an interaction effect between the two predictors. Display the summary output and write out the estimated regression equation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n$$\nadd~math~text~here\n$$\n\n\n-   **Demo:** Write the estimated regression equation for loan applications from each of the homeownership groups separately.\n    -   Rent: $add~math~text~here$\n    -   Mortgage: $add~math~text~here$\n    -   Own: $add~math~text~here$\n-   **Question:** How does the model predict the interest rate to vary as credit utilization varies for loan applicants with different homeownership status. Are the rates the same or different?\n\n*Add response here.*\n\n## Interaction effects model\n\n-   **Demo:** Fit a model to predict interest rate from credit utilization and homeownership, **with** an interaction effect between the two predictors. Display the summary output and write out the estimated regression equation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n$$\nadd~math~text~here\n$$\n\n\n-   **Demo:** Write the estimated regression equation for loan applications from each of the homeownership groups separately.\n    -   Rent: $add~math~text~here$\n    -   Mortgage: $add~math~text~here$\n    -   Own: $add~math~text~here$\n-   **Question:** How does the model predict the interest rate to vary as credit utilization varies for loan applicants with different homeownership status. Are the rates the same or different?\n\n*Add response here.*\n\n## Choosing a model\n\nRule of thumb: **Occam's Razor** - Don't overcomplicate the situation!\nWe prefer the *simplest* best model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n-   **Review:** What is R-squared? What is adjusted R-squared?\n\n*Add response here.*\n\n-   **Question:** Based on the adjusted $R^2$s of these two models, which one do we prefer?\n\n*Add response here.*\n\n# Another model to consider\n\n-   **Your turn:** Let's add one more model to the variable -- issue month. Should we add this variable to the interaction effects model from earlier?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n*Add response here.*\n",
    "supporting": [
      "ae-15-modelling-loan-interest-rates_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}