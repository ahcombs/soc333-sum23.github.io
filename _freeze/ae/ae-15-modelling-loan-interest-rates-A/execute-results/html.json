{
  "hash": "40a339e41c0431368e418adb3a901482",
  "result": {
    "markdown": "---\ntitle: \"Modelling loan interest rates\"\nsubtitle: \"Suggested answers\"\ncategories: \n  - Application exercise\n  - Answers\neditor: visual\n---\n\n\nIn this application exercise we will be studying loan interest rates.\nThe dataset is one you've come across before in your reading -- the dataset about loans from the peer-to-peer lender, Lending Club, from the **openintro** package.\nWe will use **tidyverse** and **tidymodels** for data exploration and modeling, respectively.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(openintro)\n```\n:::\n\n\nBefore we use the dataset, we'll make a few transformations to it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloans <- loans_full_schema %>%\n  mutate(\n    credit_util = total_credit_utilized / total_credit_limit,\n    bankruptcy  = as.factor(if_else(public_record_bankrupt == 0, 0, 1)),\n    verified_income = droplevels(verified_income),\n    homeownership = str_to_title(homeownership),\n    homeownership = fct_relevel(homeownership, \"Rent\", \"Mortgage\", \"Own\")\n    ) %>%\n  rename(credit_checks = inquiries_last_12m) %>%\n  select(interest_rate, verified_income, debt_to_income, credit_util, bankruptcy, term, credit_checks, issue_month, homeownership) \n```\n:::\n\n\nHere is a glimpse at the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 7\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…\n$ island            <fct> Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <fct> male, female, female, NA, female, male, female, male…\n```\n:::\n:::\n\n\n# Interest rate vs. credit utilization ratio\n\nThe regression model for interest rate vs. credit utilization is as follows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrate_util_fit <- linear_reg() |>\n  fit(interest_rate ~ credit_util, data = loans)\n\ntidy(rate_util_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  term        estimate std.error statistic   p.value\n  <chr>          <dbl>     <dbl>     <dbl>     <dbl>\n1 (Intercept)    10.5     0.0871     121.  0        \n2 credit_util     4.73    0.180       26.3 1.18e-147\n```\n:::\n:::\n\n\nAnd here is the model visualized:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(loans, aes(x = credit_util, y = interest_rate)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite values (`stat_smooth()`).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](ae-15-modelling-loan-interest-rates-A_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n-   **Your turn:** What is the estimated interest rate for a loan applicant with credit utilization of 0.8, i.e. someone whose total credit balance is 80% of their total available credit?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncredit_util_80 <- tibble(credit_util = 0.8)\n\npredict(rate_util_fit, new_data = credit_util_80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  .pred\n  <dbl>\n1  14.3\n```\n:::\n:::\n\n\n# Interest rate vs. homeownership\n\nNext we predict interest rates from homeownership, which is a categorical predictor with three levels:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(loans$homeownership)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Rent\"     \"Mortgage\" \"Own\"     \n```\n:::\n:::\n\n\n-   **Demo:** Fit the linear regression model to predict interest rate from homeownership and display a tidy summary of the model. Write the estimated model output below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrate_home_fit <- linear_reg() |>\n  fit(interest_rate ~ homeownership, data = loans)\n\ntidy(rate_home_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 5\n  term                  estimate std.error statistic  p.value\n  <chr>                    <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)             12.9      0.0803    161.   0       \n2 homeownershipMortgage   -0.866    0.108      -8.03 1.08e-15\n3 homeownershipOwn        -0.611    0.158      -3.88 1.06e- 4\n```\n:::\n:::\n\n\n-   **Your turn:** Interpret each coefficient in context of the problem.\n\n    -   Intercept: Loan applicants who rent are predicted to receive an interest rate of 12.9%, on average.\n\n    -   Slopes:\n\n        -   The model predicts that loan applicants who have a mortgage for their home receive 0.866% lower interest rate than those who rent their home, on average.\n\n        -   The model predicts that loan applicants who own their home receive 0.611% lower interest rate than those who rent their home, on average.\n\n# Interest rate vs. credit utilization and homeownership\n\n## Main effects model\n\n-   **Demo:** Fit a model to predict interest rate from credit utilization and homeownership, **without** an interaction effect between the two predictors. Display the summary output and write out the estimated regression equation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrate_util_home_fit <- linear_reg() |>\n  fit(interest_rate ~ credit_util + homeownership, data = loans)\n\ntidy(rate_util_home_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term                  estimate std.error statistic   p.value\n  <chr>                    <dbl>     <dbl>     <dbl>     <dbl>\n1 (Intercept)              9.93      0.140    70.8   0        \n2 credit_util              5.34      0.207    25.7   2.20e-141\n3 homeownershipMortgage    0.696     0.121     5.76  8.71e-  9\n4 homeownershipOwn         0.128     0.155     0.827 4.08e-  1\n```\n:::\n:::\n\n\n$$\n\\widehat{interest~rate} = 9.93 + 5.34 \\times credit~util + 0.696 \\times Mortgage - 0.128 \\times Own\n$$\n\n-   **Demo:** Write the estimated regression equation for loan applications from each of the homeownership groups separately.\n    -   Rent: $\\widehat{interest~rate} = 9.93 + 5.34 \\times credit~util$\n    -   Mortgage: $\\widehat{interest~rate} = 10.626 + 5.34 \\times credit~util$\n    -   Own: $\\widehat{interest~rate} = 10.058 + 5.34 \\times credit~util$\n-   **Question:** How does the model predict the interest rate to vary as credit utilization varies for loan applicants with different homeownership status. Are the rates the same or different?\n\nThe same.\n\n## Interaction effects model\n\n-   **Demo:** Fit a model to predict interest rate from credit utilization and homeownership, **with** an interaction effect between the two predictors. Display the summary output and write out the estimated regression equation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrate_util_home_int_fit <- linear_reg() |>\n  fit(interest_rate ~ credit_util * homeownership, data = loans)\n\ntidy(rate_util_home_int_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  term                              estimate std.error statistic  p.value\n  <chr>                                <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)                          9.44      0.199     47.5  0       \n2 credit_util                          6.20      0.325     19.1  1.01e-79\n3 homeownershipMortgage                1.39      0.228      6.11 1.04e- 9\n4 homeownershipOwn                     0.697     0.316      2.20 2.75e- 2\n5 credit_util:homeownershipMortgage   -1.64      0.457     -3.58 3.49e- 4\n6 credit_util:homeownershipOwn        -1.06      0.590     -1.80 7.24e- 2\n```\n:::\n:::\n\n\n$$\n\\widehat{interest~rate} = 9.44 + 6.20 \\times credit~util + 1.39 \\times Mortgage + 0.697 \\times Own - 1.64 \\times credit_util:Mortgage - 1.06 \\times credit_util:Own\n$$\n\n-   **Demo:** Write the estimated regression equation for loan applications from each of the homeownership groups separately.\n    -   Rent: $\\widehat{interest~rate} = 9.44 + 6.20 \\times credit~util$\n    -   Mortgage: $\\widehat{interest~rate} = 10.83 + 4.56 \\times credit~util$\n    -   Own: $\\widehat{interest~rate} = 10.137 + 5.14 \\times credit~util$\n-   **Question:** How does the model predict the interest rate to vary as credit utilization varies for loan applicants with different homeownership status. Are the rates the same or different?\n\nDifferent.\n\n## Choosing a model\n\nRule of thumb: **Occam's Razor** - Don't overcomplicate the situation!\nWe prefer the *simplest* best model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglance(rate_util_home_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 12\n  r.squared adj.r.…¹ sigma stati…²   p.value    df  logLik    AIC    BIC devia…³\n      <dbl>    <dbl> <dbl>   <dbl>     <dbl> <dbl>   <dbl>  <dbl>  <dbl>   <dbl>\n1    0.0682   0.0679  4.83    244. 1.25e-152     3 -29926. 59861. 59897. 232954.\n# … with 2 more variables: df.residual <int>, nobs <int>, and abbreviated\n#   variable names ¹​adj.r.squared, ²​statistic, ³​deviance\n```\n:::\n\n```{.r .cell-code}\nglance(rate_util_home_int_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 12\n  r.squared adj.r.…¹ sigma stati…²   p.value    df  logLik    AIC    BIC devia…³\n      <dbl>    <dbl> <dbl>   <dbl>     <dbl> <dbl>   <dbl>  <dbl>  <dbl>   <dbl>\n1    0.0694   0.0689  4.83    149. 4.79e-153     5 -29919. 59852. 59903. 232652.\n# … with 2 more variables: df.residual <int>, nobs <int>, and abbreviated\n#   variable names ¹​adj.r.squared, ²​statistic, ³​deviance\n```\n:::\n:::\n\n\n-   **Review:** What is R-squared? What is adjusted R-squared?\n\nR-squared is the percent variability in the response that is explained by our model.\n(Can use when models have same number of variables for model selection)\n\nAdjusted R-squared is similar, but has a penalty for the number of variables in the model.\n(Should use for model selection when models have different numbers of variables).\n\n-   **Question:** Based on the adjusted $R^2$s of these two models, which one do we prefer?\n\nThe interaction effects model, though just barely.\n\n# Another model to consider\n\n-   **Your turn:** Let's add one more model to the variable -- issue month. Should we add this variable to the interaction effects model from earlier?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlinear_reg() |>\n  fit(interest_rate ~ credit_util * homeownership + issue_month, data = loans) |>\n  glance()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 12\n  r.squared adj.r.…¹ sigma stati…²   p.value    df  logLik    AIC    BIC devia…³\n      <dbl>    <dbl> <dbl>   <dbl>     <dbl> <dbl>   <dbl>  <dbl>  <dbl>   <dbl>\n1    0.0694   0.0688  4.83    106. 5.62e-151     7 -29919. 59856. 59921. 232641.\n# … with 2 more variables: df.residual <int>, nobs <int>, and abbreviated\n#   variable names ¹​adj.r.squared, ²​statistic, ³​deviance\n```\n:::\n:::\n\n\nNo, the adjusted R-squared goes down.\n",
    "supporting": [
      "ae-15-modelling-loan-interest-rates-A_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}